<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>表情包裁剪工具</title>
    <script charset="UTF-8" id="LA_COLLECT" src="https://sdk.51.la/js-sdk-pro.min.js"></script>
    <script>LA.init({id:"3OD21nybLiha2FZf",ck:"3OD21nybLiha2FZf",autoTrack:true})</script>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="tablet.css">
    <link rel="stylesheet" href="phone.css">
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
</head>
<body>
    <div class="app-container">
        <!-- 顶部标题栏 -->
        <header class="app-header">
            <h1>表情包裁剪工具</h1>
            <div class="header-actions">
                <a href="https://www.xiaoheihe.cn/app/bbs/link/169557257" target="_blank" class="publish-link" title="查看发布页">
                    <i data-feather="external-link"></i>
                    <span>发布页 · 求关注</span>
                </a>
                <button class="theme-toggle" id="themeToggle" title="切换主题">
                    <i data-feather="sun" class="theme-icon-light"></i>
                    <i data-feather="moon" class="theme-icon-dark"></i>
                </button>
            </div>

            <!-- 移动端标签导航 -->
            <nav class="mobile-tabs" id="mobileTabs">
                <button class="mobile-tab active" data-tab="settings">
                    <i data-feather="settings"></i>
                    <span>基本设置</span>
                </button>
                <button class="mobile-tab" data-tab="workspace">
                    <i data-feather="edit-3"></i>
                    <span>工作空间</span>
                </button>
                <button class="mobile-tab" data-tab="resources">
                    <i data-feather="image"></i>
                    <span>资源管理</span>
                </button>
            </nav>
        </header>

        <div class="main-content">
            <!-- 左侧工具面板 -->
            <aside class="panel panel-left">
                <div class="panel-section collapsible">
                    <h2 class="section-header" data-section="import">
                        <i data-feather="chevron-down" class="collapse-icon"></i>
                        图片导入
                    </h2>
                    <div class="section-content">
                        <div class="upload-area" id="uploadArea">
                            <i data-feather="folder" class="upload-icon"></i>
                            <div class="upload-text">点击或拖拽图片<br>支持 JPG、PNG</div>
                        </div>
                        <input type="file" id="fileInput" accept="image/jpeg,image/png,image/gif,image/webp">

                        <div class="image-info hidden" id="imageInfo">
                            <p><strong>文件:</strong> <span id="fileName">-</span></p>
                            <p><strong>尺寸:</strong> <span id="imageSize">-</span></p>
                            <p><strong>单元格:</strong> <span id="cellSize">-</span></p>
                        </div>
                    </div>
                </div>

                <div class="panel-section collapsible">
                    <h2 class="section-header" data-section="mode">
                        <i data-feather="chevron-down" class="collapse-icon"></i>
                        裁剪模式
                    </h2>
                    <div class="section-content">
                        <div class="mode-switch">
                            <button class="mode-btn active" id="modeUniform" data-mode="uniform">均匀网格</button>
                            <button class="mode-btn" id="modeCenterLine" data-mode="centerline">中心线</button>
                        </div>
                        <p class="mode-hint" id="modeHint">自动将图片等分为网格</p>

                        <div class="individual-mode-toggle hidden" id="individualModeToggle">
                            <label class="checkbox-label">
                                <input type="checkbox" id="individualModeCheckbox">
                                <span>单独调整模式</span>
                            </label>
                            <p class="control-hint">开启后可直接拖拽调整每个单元格边界</p>
                        </div>
                    </div>
                </div>

                <div class="panel-section collapsible">
                    <h2 class="section-header" data-section="grid">
                        <i data-feather="chevron-down" class="collapse-icon"></i>
                        网格设置
                    </h2>
                    <div class="section-content">
                        <div class="quick-grids">
                            <button class="quick-grid-btn" data-rows="2" data-cols="2">2×2</button>
                            <button class="quick-grid-btn" data-rows="3" data-cols="3">3×3</button>
                            <button class="quick-grid-btn" data-rows="4" data-cols="4">4×4</button>
                            <button class="quick-grid-btn" data-rows="4" data-cols="6">4×6</button>
                            <button class="quick-grid-btn active" data-rows="6" data-cols="4">6×4</button>
                            <button class="quick-grid-btn" data-rows="5" data-cols="5">5×5</button>
                        </div>

                        <div class="control-group">
                            <label>行数</label>
                            <div class="control-row">
                                <input type="range" id="rowsRange" min="1" max="12" value="6">
                                <input type="number" id="rowsInput" min="1" max="20" value="6">
                            </div>
                        </div>

                        <div class="control-group">
                            <label>列数</label>
                            <div class="control-row">
                                <input type="range" id="colsRange" min="1" max="12" value="4">
                                <input type="number" id="colsInput" min="1" max="20" value="4">
                            </div>
                        </div>

                        <div class="control-group centerline-only hidden" id="cellSizeControl">
                            <label>单元格尺寸</label>
                            <div class="control-row cell-size-row">
                                <span>宽:</span>
                                <input type="number" id="cellWidth" min="10" value="100">
                                <span>高:</span>
                                <input type="number" id="cellHeight" min="10" value="100">
                                <button class="btn-icon" id="autoCalcSize" title="自动计算最优尺寸">
                                    <i data-feather="zap"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="panel-section collapsible collapsed">
                    <h2 class="section-header" data-section="background">
                        <i data-feather="chevron-down" class="collapse-icon"></i>
                        抠除背景
                    </h2>
                    <div class="section-content">
                        <div class="control-group">
                            <label>背景颜色</label>
                            <div class="control-row">
                                <input type="color" id="bgRemoveColor" value="#ffffff">
                                <button class="btn-icon" id="pickBgColor" title="从图片拾取颜色">
                                    <i data-feather="crosshair"></i>
                                </button>
                            </div>
                        </div>

                        <div class="control-group">
                            <label>颜色相似度</label>
                            <div class="control-row">
                                <input type="range" id="bgTolerance" min="0" max="100" value="30">
                                <span class="value-display" id="bgToleranceValue">30</span>
                            </div>
                        </div>

                        <div class="control-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="bgContiguous" checked>
                                <span>仅连续区域</span>
                            </label>
                            <p class="control-hint">勾选后只移除与边缘相连的背景</p>
                        </div>

                        <button class="btn btn-primary" id="removeBgBtn">
                            <i data-feather="scissors"></i> 移除背景
                        </button>
                        <button class="btn btn-secondary" id="resetBgBtn">
                            <i data-feather="rotate-ccw"></i> 还原图片
                        </button>
                    </div>
                </div>
                <div class="panel-section collapsible collapsed">
                    <h2 class="section-header" data-section="style">
                        <i data-feather="chevron-down" class="collapse-icon"></i>
                        网格样式
                    </h2>
                    <div class="section-content">
                        <div class="control-group">
                            <label>线条颜色</label>
                            <div class="control-row">
                                <input type="color" id="gridColor" value="#ff0000">
                                <span class="value-display" id="colorValue">#ff0000</span>
                            </div>
                        </div>

                        <div class="control-group">
                            <label>线条粗细</label>
                            <div class="control-row">
                                <input type="range" id="lineWidth" min="1" max="10" value="2">
                                <span class="value-display" id="lineWidthValue">2px</span>
                            </div>
                        </div>

                        <button class="btn btn-secondary btn-small" id="resetLines">重置中心线</button>
                    </div>
                </div>
            </aside>

            <!-- 中间编辑区域 -->
            <main class="panel panel-main">
                <div class="canvas-header">
                    <span class="canvas-title">编辑区域 &nbsp;</span>
                    
                    <div class="zoom-controls">
                        <button class="zoom-btn" id="zoomOut" title="缩小">
                            <i data-feather="minus"></i>
                        </button>
                        <span class="zoom-value" id="zoomValue">100%</span>
                        <button class="zoom-btn" id="zoomIn" title="放大">
                            <i data-feather="plus"></i>
                        </button>
                        <button class="zoom-btn" id="zoomFit" title="适应窗口">
                            <i data-feather="maximize"></i>
                        </button>
                        <button class="zoom-btn" id="zoomReset" title="原始大小">
                            <i data-feather="square"></i>
                        </button>
                    </div>
                    <span class="canvas-title">&nbsp;&nbsp;</span>
                    <span class="hint" id="editHint"></span>
                    <div class="history-controls">
                        <button class="history-btn" id="historyUndo" title="撤销 (Ctrl+Z)" disabled>
                            <i data-feather="corner-up-left"></i>
                        </button>
                        <span class="history-info" id="historyInfo">0/0</span>
                        <button class="history-btn" id="historyRedo" title="重做 (Ctrl+Y)" disabled>
                            <i data-feather="corner-up-right"></i>
                        </button>
                    </div>
                </div>
                <div class="canvas-container" id="canvasContainer">
                    <canvas id="mainCanvas"></canvas>
                    <div class="canvas-placeholder" id="placeholder">
                        <i data-feather="image" class="placeholder-icon"></i>
                        <p>请先导入图片</p>
                    </div>
                </div>
            </main>

            <!-- 右侧预览和导出面板 -->
            <aside class="panel panel-right">
                <div class="panel-section">
                    <h2>导出设置</h2>
                    <div class="control-group">
                        <label>文件名前缀</label>
                        <input type="text" id="filePrefix" value="emoji" placeholder="文件名前缀">
                    </div>

                    <div class="control-group">
                        <label>导出格式</label>
                        <select id="exportFormat">
                            <option value="png">PNG (透明)</option>
                            <option value="jpeg">JPEG (小)</option>
                            <option value="webp">WebP</option>
                        </select>
                    </div>

                    <div class="control-group">
                        <label>图片质量</label>
                        <div class="control-row">
                            <input type="range" id="quality" min="0.1" max="1" step="0.1" value="0.9">
                            <span class="value-display" id="qualityValue">90%</span>
                        </div>
                    </div>

                    <button class="btn btn-primary" id="exportBtn" disabled>
                        <i data-feather="package"></i> 导出 ZIP
                    </button>
                    <button class="btn btn-secondary" id="exportSingleBtn" disabled>
                        <i data-feather="download"></i> 分别下载
                    </button>
                </div>

                <div class="panel-section panel-section-preview">
                    <h2>预览 (<span id="previewCount">0</span>张)</h2>
                    <div class="preview-list" id="previewGrid">
                    </div>
                </div>
            </aside>
        </div>
    </div>

    <!-- 进度提示 -->
    <div class="progress-overlay hidden" id="progressOverlay">
        <div class="progress-box">
            <div class="spinner"></div>
            <p id="progressText">正在处理...</p>
        </div>
    </div>

    <!-- 裁剪编辑弹窗 -->
    <div class="modal-overlay hidden" id="cropModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>编辑裁剪区域 <span id="cropModalIndex"></span></h3>
                <button class="modal-close" id="cropModalClose">&times;</button>
            </div>
            <div class="modal-body">
                <div class="crop-canvas-container">
                    <canvas id="cropCanvas"></canvas>
                </div>
                <div class="crop-controls">
                    <div class="crop-info">
                        <span>位置: <span id="cropPosition">0, 0</span></span>
                        <span>尺寸: <span id="cropSize">100 x 100</span></span>
                    </div>
                    <div class="crop-actions">
                        <button class="btn btn-secondary" id="cropReset">重置</button>
                        <button class="btn btn-secondary" id="cropCenter">居中</button>
                        <button class="btn btn-danger" id="cropDisable">
                            <i data-feather="eye-off"></i> 禁用
                        </button>
                        <button class="btn btn-primary" id="cropSave">保存修改</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 大图预览弹窗 -->
    <div class="modal-overlay hidden" id="imagePreviewModal">
        <div class="image-preview-content">
            <button class="modal-close" id="imagePreviewClose">&times;</button>
            <img id="imagePreviewImg" src="" alt="大图预览">
            <div class="image-preview-info" id="imagePreviewInfo"></div>
        </div>
    </div>

    <!-- 赞助固钉 -->
    <div class="sponsor-affix" id="sponsorAffix">
        <div class="sponsor-collapsed">
            <i data-feather="heart" class="sponsor-icon"></i>
        </div>
        <div class="sponsor-expanded">
            <div class="sponsor-title">赞助支持</div>
            <img src="sponsor-qrcode.png" alt="赞助二维码" class="sponsor-qrcode">
            <div class="sponsor-text">感谢您的支持</div>
        </div>
    </div>

    <script> feather.replace() </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="app.js"></script>
</body>
</html>
